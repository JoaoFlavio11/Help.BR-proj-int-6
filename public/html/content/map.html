<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link
      rel="stylesheet"
      href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@20..48,100..700,0..1,-50..200"
    />
    <link
      rel="stylesheet"
      href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.4/font/bootstrap-icons.css"
    />
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha2/dist/css/bootstrap.min.css"
      rel="stylesheet"
      integrity="sha384-aFq/bzH65dt+w6FI2ooMVUpc+21e0SRygnTpmBvdBgSdnuTN7QbdgL+OapgHtvPp"
      crossorigin="anonymous"
    />
    <link
      rel="stylesheet"
      href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"
    />
    <link rel="stylesheet" href="../../css/index.css" />
    <title>Mapa</title>
  </head>

  <body>
    <!--Navbar-->
    <nav class="navbar navbar-expand-lg">
      <div class="container-fluid">
        <a class="navbar-brand" href="#">Help.Br</a>
        <button
          class="navbar-toggler"
          type="button"
          data-bs-toggle="collapse"
          data-bs-target="#navbarSupportedContent"
          aria-controls="navbarSupportedContent"
          aria-expanded="false"
          aria-label="Toggle navigation"
        >
          <span class="navbar-toggler-icon"></span>
        </button>
        <div class="collapse navbar-collapse" id="navbarSupportedContent">
          <ul class="navbar-nav justify-content-end flex-grow-1 pe-3"></ul>
          <form class="d-flex" role="search">
            <input
              class="form-control me-2"
              type="search"
              placeholder="Search"
              aria-label="Search"
            />
            <button class="btn botao-padrao" type="submit">Search</button>
          </form>
        </div>
      </div>
    </nav>
    <!--Navbar end-->

    <!-- The sidebar -->
    <aside>
      <div class="sidebar">
        <!-- Botão de Menu com Título -->
        <button id="menuToggle" class="hamburger">
          <span class="material-symbols-outlined">menu</span>
          <span class="title">Help.BR</span>
        </button>

        <a href="http://localhost:3000/" title="Página Inicial">
          <span class="material-symbols-outlined">grid_view</span>
          <h3><b>Página Inicial</b></h3>
        </a>

        <a href="http://localhost:3000/doacoes" title="Doações disponíveis">
          <span class="material-symbols-outlined">insert_chart</span>
          <h3><b>Doações disponíveis</b></h3>
        </a>

        <a href="http://localhost:3000/cadastroDoacao" title="Crie sua Doação!">
          <span class="material-symbols-outlined">heart_plus</span>
          <h3><b>Crie sua Doação!</b></h3>
        </a>

        <a
          href="http://localhost:3000/parceiros"
          title="Patrocine nosso projeto"
        >
          <span class="material-symbols-outlined">settings_accessibility</span>
          <h3><b>Patrocine nosso projeto</b></h3>
        </a>

        <a
          href="http://localhost:3000/colab/partner"
          title="Seja nosso parceiro"
        >
          <span class="material-symbols-outlined">person_raised_hand</span>
          <h3><b>Seja nosso parceiro</b></h3>
        </a>

        <a
          href="http://localhost:3000/location/support"
          title="Pontos de apoio"
        >
          <span class="material-symbols-outlined">add_location_alt</span>
          <h3><b>Pontos de apoio</b></h3>
        </a>

        <a onclick="logout()" title="Sair">
          <span class="material-symbols-outlined">exit_to_app</span>
          <h3><b>Sair</b></h3>
        </a>
      </div>
    </aside>
    <!--Sidebar end-->

    <!-- Mapa -->
    <div class="container">
      <h1>Localização dos Pontos de Apoio</h1>
      <div
        id="map"
        style="
          height: 400px;
          width: 50rem;
          margin-top: 5rem;
          margin-left: 27.5rem;
          border: 1px solid #ddd;
        "
      ></div>
    </div>
    <!-- Mapa end -->

    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    <script>
      // Inicializar o mapa
      const map = L.map("map").setView([-23.55052, -46.633308], 13); // Coordenadas de São Paulo como exemplo

      // Adicionar camada de tiles do OpenStreetMap
      L.tileLayer("https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png", {
        attribution:
          '&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors',
      }).addTo(map);

      // Função para desenhar uma área no mapa
      function desenharArea(corner1, corner2) {
        const bounds = [corner1, corner2]; // Coordenadas opostas para o retângulo
        const rectangle = L.rectangle(bounds, {
          color: "blue",
          weight: 2,
        }).addTo(map);

        // Adicionar evento de clique no retângulo
        rectangle.on("click", () => {
          alert("Você clicou em uma área desenhada!");
        });

        // Mostrar popup ao passar o mouse sobre a área
        rectangle.on("mouseover", (e) => {
          rectangle
            .bindPopup(
              `<b>Área Selecionada</b><br>
          Lat inicial: ${corner1[0].toFixed(5)}, Lng inicial: ${corner1[1].toFixed(5)}<br>
          Lat final: ${corner2[0].toFixed(5)}, Lng final: ${corner2[1].toFixed(5)}`,
            )
            .openPopup(e.latlng);
        });

        // Evento de sair do retângulo
        rectangle.on("mouseout", () => {
          rectangle.closePopup();
        });
      }

      // Coordenadas de exemplo para áreas fixas
      desenharArea([-23.551, -46.634], [-23.552, -46.635]);
      desenharArea([-23.553, -46.636], [-23.554, -46.637]);

      // Adicionar funcionalidade interativa de desenho
      let isDrawing = false;
      let startPoint;

      map.on("mousedown", (e) => {
        // Início do desenho
        isDrawing = true;
        startPoint = [e.latlng.lat, e.latlng.lng];
      });

      map.on("mouseup", (e) => {
        if (isDrawing) {
          const endPoint = [e.latlng.lat, e.latlng.lng];
          desenharArea(startPoint, endPoint); // Desenha o retângulo com os pontos inicial e final
          isDrawing = false; // Finaliza o desenho
          alert("Área desenhada com sucesso!");
        }
      });
    </script>
  </body>
</html>
